# 大型软件设计 接口设计

## 登录注册

### 登录

#### POST /login

参数

| 参数名   | 说明   | 备注 |
| -------- | ------ | ---- |
| username | 用户名 |      |
| password | 密码   |      |

登录成功
返回

```json
{
    "status_code": 200,
    "token": 长度为64的随机字符串,
    "msg": 登录成功 
}
```

登录失败
返回

```json
{
    "status_code": 403,
    "msg": '用户名或密码错误' 
}
```

登录参数不全
返回
```json
{
    "status_code": 404,
    "msg": '请求参数错误'
}
```

**登录后所有请求需携带token**

token字段名为'token'

token鉴权失败会返回"token失效或错误"

### 注册

#### POST /user

参数

| 参数名   | 说明   | 备注 |
| -------- | ------ | ---- |
| username | 用户名 |      |
| password | 密码   |      |

返回

注册成功
返回
```json
{
    "status_code": 200,
    "msg": 注册成功 
}
```

用户名重复注册失败
返回
```json
{
    "status_code": 403,
    "msg": '用户名重复，请更换用户名'
}
```

注册参数不全
返回
```json
{
    "status_code": 404,
    "msg": '请求参数错误'
}
```

## 创建房间

### POST /room

参数 带token请求

| 参数名   | 说明   | 备注 |
| -------- | ------ | ---- |
| lexicon_id | 词库id |      |

创建成功
返回

```
{
	"status_code": 200,
	"room_id":8位字符串,
    "msg": 创建成功
}
```

缺少参数
返回
```json
{
    "status_code": 404,
    "msg": '请求参数错误'
}
```


## 获取房间状态

### GET /room

参数

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |

需要携带token访问

获取成功
返回

```
{
	"status_code": 200,
	'msg' : '获取成功',
	"state": 0/1, 0为未开始，1为开始
	"lexicon_id": 词库id,
	"member": [], 返回列表，内容为成员用户名
	"ready": [], 01列表，与member列表一一对应，代表准备状态
	"owner": 用户名,
	"self_ready" : 自己是否准备好了（true/false）
}
```

玩家不在当前房间
返回
```json
{
    "status_code": 403,
    "msg": '玩家不在此房间中'
}
```

room_id缺少或错误
返回
```json
{
    "status_code": 404,
    "msg": '房间不存在'
}
```

## 加入房间

### POST /join

参数 

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |

成功加入
返回

```
{
	"status_code": 200
    "msg": 加入成功
}
```

缺少房间号
返回

```
{
	"status_code": 404
    "msg": '请求参数错误'
}
```

房间不存在
返回

```
{
	"status_code": 403
    "msg": '房间不存在'
}
```

## 准备、开始

### POST /start

房主为开始、成员为准备

只有所有人准备才能开始，成员点击后切换准备状态

参数 

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |

返回

房主

```
{
	"status_code": 200,
    "msg": 开始
}
```

```
{
	"status_code": 201,
    "msg": 有人未准备
}
```

成员

```
{
	"status_code": 200,
    "msg": 准备\取消准备
}
```

## 词库选择

### POST /lexicon

参数

| 参数名     | 说明     | 备注 |
| ---------- | -------- | ---- |
| room_id    | 房间号   |      |
| lexicon_id | 词库编号 |      |

修改成功
返回

```
{
	"status_code": 200,
    "msg": 修改成功
}
```

需要携带房间创建者的token。
如果不是创建者，返回
```
{
	"status_code": 403,
    "msg": 无修改权限
}
```

参数不足
返回
```
{
	"status_code": 404
    "msg": '请求参数错误'
}
```

## 获取词语/图片

### GET /work

参数

| 参数名   | 说明                          | 备注 |
| -------- | ----------------------------- | ---- |
| room_id  | 房间号                        |      |
| round    | 轮数                          |      |

参数不全
返回
```
{
	"status_code": 404,
	"msg": '请求参数错误'
}
```

参数错误
返回
```
{
	"status_code": 404,
	"msg": '参数错误'
}
```

成功获取
返回

```
{
	"status_code": 200,
	"word":待猜测的词语,
	"type": 1,
	"msg": '获取成功'
	"img":空
}
```
或者
```
{
	"status_code": 200,
	"word":待猜测的词语,
	"type": 1,
	"msg": '获取成功'
	"img":空
}
```

## 提交词语/图片

### POST /submit

参数

| 参数名  | 说明                                  | 备注 |
| ------- | ------------------------------------- | ---- |
| is_word | 0/1，代表是否为词语，1为词语，0为图片 |      |
| word    | is_word为1时使用，词语                |      |
| img     | is_word为0时使用，图片                |      |
| room_id | 房间号                                |      |
| round   | 当前轮数                              |      |

返回

```
{
	"status_code": 200,
	"msg":提交成功
}
```

## 获取当前轮数

### GET /round

参数

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |

返回

```
{
	"status_code": 200,
	"round": 轮数,
	'round_state':当前轮状态（-1 未进入该轮）/（0 未全部准备开始该轮）/（1 该轮开始，正在进行）/（2 该轮结束，等待自动提交）,
	'submit_num':已提交人数,
	'start_time':该轮开始时间,
	'ready_num': 该轮已准备人数，
	'is_ready': 玩家是否已经准备,
	'is_submit' : 玩家是否已经提交,
	'msg': 获取成功
}
```

房间号有问题
返回
```
{
	"status_code": 404,
	"msg":'房间号错误'
}
```

轮数记录出现未知问题
返回
```
{
	"status_code": 404,
	"msg":'轮数错误'
}
```

## 投票

### GET /vote

获取投票结果

参数

| 参数名   | 说明               | 备注 |
| -------- | ------------------ | ---- |
| room_id  | 房间号             |      |
| username | 最终猜词人的用户名 |      |

返回

```
{
	"status_code": 200,
	"approval": 同意结果的人数，
	"disapproval": 反对结果的人数
}
```



### POST /vote

用户投票

参数

| 参数名   | 说明                       | 备注 |
| -------- | -------------------------- | ---- |
| room_id  | 房间号                     |      |
| username | 最终猜词人的用户名         |      |
| result   | 0/1 0代表不同意，1代表同意 |      |

返回

```
{
	"status_code": 200
}
```

## 退出

### POST /exit

退出房间，房主退出后房间解散

参数

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |

返回

```
{
	"status_code": 200,
	"msg":房间已解散（房主）/房间已退出（成员）
}
```

room_id有误
返回
```
{
	"status_code": 404,
	"msg":'房间未找到'
}
```

用户不在房间中
返回
```
{
	"status_code": 403,
	"msg":'不在房间内'
}
```

## 回合准备

### GET /ready

开始游戏后每回合的准备接口

需要携带token访问

参数

| 参数名  | 说明   | 备注 |
| ------- | ------ | ---- |
| room_id | 房间号 |      |
| round | 轮次号 |      |

房间号错误
返回
```
{
	"status_code": 404,
	"msg":'房间号错误'
}
```

轮次号错误
返回
```
{
	"status_code": 404,
	"msg":'轮次错误'
}
```

本轮还未开始
返回
```
{
	"status_code": 403,
	"msg":'未进入该回合'
}
```

玩家已准备过
返回
```
{
	"status_code": 200,
	"msg":'玩家本轮已准备'
}
```

成功准备
返回
```
{
	"status_code": 200,
	"msg":'本轮准备成功'
}
```

回合正在进行或已经结束
返回
```
{
	"status_code": 401,
	"msg":'回合正在进行或已结束'
}
```